<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VisionServer: Using WPILibPi</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/FRC3407/VisionServer" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VisionServer
   &#160;<span id="projectnumber">v2.0.0-75-g3988025</span>
   </div>
   <div id="projectbrief">FRC vision library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_guide_WPILibPi_Info.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using WPILibPi </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><b>Before reading this guide, make sure to familiarize yourself with WPILibPi using <a href="https://docs.wpilib.org/en/stable/docs/software/vision-processing/wpilibpi/">its own docs</a>.</b></p>
<h1>Shared Libraries - IMPORTANT</h1>
<h1><a class="anchor" id="autotoc_md12"></a>
WPILibPi comes preinstalled with WPILib, OpenCV, and Pigpio, but not with Tensorflow Lite (only the python version is present, not C++) or the Edge TPU driver - these will have to be uploaded manually. Both files (libtensorflowlite.so and libedgetpu.so) are copied to the output directory during each VS build, and can be found there for uploading on the Pi using the web dashboard (these are treated as "supplementary files" in step 2 below). Uploading these should be a one-time process, but will need to be repeated when newer versions of WPILibPi are released, and this repo is updated with newer versions of TfLite and the EdgeTPU driver.</h1>
<h1>Deployment Process</h1>
<ol type="1">
<li><b>Build your project (and/or VS).</b></li>
<li><b>Go to the WPILibPi dashboard (<a href="http://wpilibpi">http://wpilibpi</a> or <a href="http://IP_ADDRESS_OF_RPI">http://IP_ADDRESS_OF_RPI</a>) in your browser and navigate to the <code>Application</code> tab.</b> Make sure to toggle the Pi into <b>Writable</b> mode using the button at the top of the page.<ul>
<li>To upload a new vision program, select __"Uploaded C++ executable"__ from the dropdown, then select the binary from the output directory and upload it.</li>
<li>To upload a new version of the VisionServer shared library (libvs3407.so), or other supplementary files (ex. a tflite model), navigate towards the bottom of the page under __"Upload other files"__ and select the required files. Note that in the case of the shared library, the old version within the Pi's filesystem will simply be replaced with the newer version provided that they are named the same.</li>
<li>Change the Pi back to <b>Read-Only</b> mode before proceeding.</li>
</ul>
</li>
<li><b>Run the program.</b> This can be done through the web dashboard or by ssh'ing into the Pi and running the program manually.<ul>
<li>On the dashboard, navigate to the <code>Vision Status</code> tab and select the __"Up"__ option to start the program. Additionally make sure to enable console output, which is oftentimes crucial for debugging. </li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md13"></a>
* When ssh'ed into the Pi, enter &lt;tt&gt;sudo ./uploaded&lt;/tt&gt; to run the program. This can be helpful when more direct terminal output is needed (sometimes the dashboard can be misformatted and skip some lines).</h1>
<h1>"Patches"</h1>
<p >For some reason uploaded executables may require sudo permissions to work properly, and without can sometimes fail to output streams and simply not work correctly. By default, WPILibPi runs uploaded executables without sudo, but this can be changed with a few modifications.</p><ol type="1">
<li><b>SSH into your Pi.</b> Additionally go to the web dashboard and set the Pi to <b>Writable</b> mode.</li>
<li><b>Enter <code>sudo nano /etc/service/camera/run</code> to begin editing this file.</b></li>
<li><b>Change <code>exec pgrphack /usr/local/bin/setuidgids pi ./runCamera</code> to <code>exec pgrphack ./runCamera</code>.</b></li>
<li><b>Use <code>Ctrl + S</code> to save, then <code>Ctrl + X</code> to exit.</b> </li>
</ol>
<h1><a class="anchor" id="autotoc_md14"></a>
5. &lt;strong&gt;Set the Pi back to __Read-Only&lt;/strong&gt; and run the program through the dashboard - it should work normally.__</h1>
<h1>Troubleshooting (Robot Deployment)</h1>
<p >Using and connecting to the Pi directly may seem fluid and stable, but there are a whole host of issues that can arrise during robot deployment. This can include anything from short stutters/freezing video streams, to unresponsive connections and a complete inability to connect.</p>
<ul>
<li>Make sure the Pi is in __"Client"__ mode when connected to a robot (changed in the <code>Network Settings</code> tab). This can be a very difficult issue to diagnose due to the fact that sometimes NetworkTables will work correctly and other times it will not. Additionally, this can be quite common if server mode is used for testing the Pi while not operating on a robot.</li>
<li>Make sure that the radio power is secure. Sometimes the wires can be poorly connected to the VRM and cause short intermittances. This will not affect robot control, but does cause a much longer delay (freeze) in all RPi communications. This problem can be diagnosed if the ethernet LEDs on the Pi go dark during operation, as this means that communication has been lost between the radio and Pi.</li>
<li>Make sure that the ethernet cable is sequrely connected. This can be a similar issue to the previous, where either a bad cable or loose plug can cause intermittant disconnections.</li>
<li>Make sure to update NetworkTable dashboard settings from testing. Oftentimes these will be set to connect directly to the Pi for testing, but must be reset during robot control so that they connect to the RoboRIO. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 12 2022 03:43:27 for VisionServer by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
